## ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € ğŸ¦

### ëª©ì°¨
- [1. ì†Œê°œ](#1-ì†Œê°œ)
- [2. íŒ€ì›](#2-íŒ€ì›)
- [3. íƒ€ì„ë¼ì¸](#3-íƒ€ì„ë¼ì¸)
- [4. í”„ë¡œì íŠ¸ êµ¬ì¡°](#4-í”„ë¡œì íŠ¸-êµ¬ì¡°)
- [5. ì‹¤í–‰ í™”ë©´](#5-ì‹¤í–‰-í™”ë©´)
- [6. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…](#6-íŠ¸ëŸ¬ë¸”-ìŠˆíŒ…)
- [7. íŒ€ íšŒê³ ](#7-íŒ€-íšŒê³ )
- [8. ì°¸ê³  ìë£Œ](#8-ì°¸ê³ -ìë£Œ)

---
### 1. ì†Œê°œ
- ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € ì•±ì„ ì†Œê°œí•©ë‹ˆë‹¤! 
- ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € ì½˜ì†” ì•±ì€`1. ì€í–‰ê°œì ` `2. ì¢…ë£Œ` ë©”ë‰´ë¡œ ì´ë¤„ì ¸ ìˆìŠµë‹ˆë‹¤. 1ë²ˆì„ ì…ë ¥í•˜ì—¬ ì€í–‰ê°œì ì„ í•˜ì‹œë©´ í•œ ëª…ì˜ ì€í–‰ì›ì´ ê·¼ë¬´ë¥¼ í•˜ê²Œ ë˜ê³ , 10ëª… ~ 30ëª… ì‚¬ì´ì˜ ê³ ê°ì„ ë°›ì•„ ì°¨ë¡€ì°¨ë¡€ ì—…ë¬´ë¥¼ ë„ì™€ë“œë¦½ë‹ˆë‹¤. ğŸ‘
- ëª¨ë“  ê³ ê°ì˜ ì—…ë¬´ê°€ ëë‚˜ë©´ ì€í–‰ë¬¸ì€ ë‹«íˆê²Œ ë˜ê³ , ë©”ë‰´ê°€ ë‹¤ì‹œ ì¶œë ¥ë©ë‹ˆë‹¤.
- ì˜¤ëŠ˜ì€ ì–¼ë§ˆë‚˜ ë§ì€ ê³ ê°ì„ ë°›ì„ ìˆ˜ ìˆì„ê¹Œìš”? ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì € ì•±ì„ í†µí•´ ì€í–‰ì°½êµ¬ ë§¤ë‹ˆì €ì˜ ê·¹í•œì§ì—…ì„ ì²´í—˜í•´ë´…ì‹œë‹¤. ğŸ˜…

### 2. íŒ€ì›
| <img src="https://avatars.githubusercontent.com/u/154333967?v=4" width="200"> | <img src="https://avatars.githubusercontent.com/u/27756800?v=4" width="200"> |
| :-: | :-: |
| Danny ([Github](https://github.com/dannykim1215)) | Prism ([Github](https://github.com/PrismSpirit)) |

### 3. íƒ€ì„ë¼ì¸
| ë‚ ì§œ | ì œëª© |
| --- | --- |
| 24.03.18(ì›”) ~ 03.20(ìˆ˜) | Queueì— ì‚¬ìš©í•  Generic List êµ¬í˜„(`SinglyLinkedList`) |
| 24.03.21(ëª©) | ëŒ€ê¸°ì—´ì— ë“¤ì–´ê°ˆ ê³ ê°ì˜ ì •ë³´ë¥¼ ë‹´ëŠ” `Customer` íƒ€ì… ìƒì„±<br>BankManager íƒ€ì… ìƒì„± ë° ì—…ë¬´ ê°œì‹œ ê¸°ëŠ¥ êµ¬í˜„(`DispatchQueue`ì™€ `DispatchSemaphore` í™œìš©)<br>Bank ì´ ì—…ë¬´ì‹œê°„ì„ êµ¬í•˜ëŠ” ë¡œì§ êµ¬í˜„(`DispatchTime` í™œìš©) |
| 24.03.22(ê¸ˆ) | BankManager ì½˜ì†” ì•± êµ¬í˜„ |
| 24.03.27(ìˆ˜) ~ 03.28(ëª©) | ì—…ë¬´(ëŒ€ì¶œ, ì˜ˆê¸ˆ)ì— ë”°ë¥¸ ì€í–‰ì› ì„¸ë¶„í™” |
| 24.03.29(ê¸ˆ) | ê³ ê°ì´ ì›í•˜ëŠ” ì—…ë¬´ì— ë”°ë¼ ì€í–‰ì›ì— ê³ ê°ì„ ë¶„ë°°(`DispatchSemaphore` í™œìš©)<br> ì€í–‰ ì—…ë¬´ê°€ ì‹œì‘ë˜ì—ˆì„ ë•Œì™€ ì¢…ë£Œë˜ì—ˆì„ ë•Œì˜ í–‰ë™ì„ í•´ë‹¹ ëª¨ë“ˆ(`BankManger`)ì„ ì‚¬ìš©í•˜ëŠ” ì•±ì— ìœ„ì„í•´ì£¼ê¸° ìœ„í•´ Delegate íŒ¨í„´ì„ í™œìš© |

### 4. í”„ë¡œì íŠ¸ êµ¬ì¡°
![img](<https://raw.githubusercontent.com/dannykim1215/ios-bank-manager/ic_11_danny/BankManager_ClassDiagram.png>)

### 5. ì‹¤í–‰ í™”ë©´
- **Console App**

| ì€í–‰ ì—…ë¬´ ê°œì‹œ |
| :---: |
| <img src="https://raw.githubusercontent.com/dannykim1215/ios-bank-manager/ic_11_danny/Screenshots/Recording_ConsoleApp_Commence.gif" width=500> |

| ìœ íš¨í•˜ì§€ ì•Šì€ ë©”ë‰´ ì„ íƒ ì²˜ë¦¬ |
| :---: |
| <img src="https://raw.githubusercontent.com/dannykim1215/ios-bank-manager/ic_11_danny/Screenshots/Recording_ConsoleApp_Invalid_Input.gif" width=500> |

| ì•± ì¢…ë£Œ |
| :---: |
| <img src="https://raw.githubusercontent.com/dannykim1215/ios-bank-manager/ic_11_danny/Screenshots/Recording_ConsoleApp_Exit.gif" width=500> |

### 6. íŠ¸ëŸ¬ë¸” ìŠˆíŒ…
#### 1. â—ï¸ì´ ì—…ë¬´ì‹œê°„ ê³„ì‚°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•œ ë¬¸ì œ
##### ğŸ“Œ ë¬¸ì œ ìƒí™©
- ì€í–‰ì›ì´ í•œ ëª…ì¼ ë•ŒëŠ” ë¬¸ì œê°€ ë˜ì§€ ì•Šìœ¼ë‚˜ ì—¬ëŸ¬ ëª…ì˜ ì€í–‰ì›ì´ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•  ê²½ìš° ì´ ì—…ë¬´ ì‹œê°„ì„ ìˆ˜ë™ìœ¼ë¡œ ì¶”ì í•´ ì¹´ìš´íŒ…í•˜ëŠ” ê²ƒì€ ë§¤ìš° ë²ˆê±°ë¡œìš°ë©° ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤.

```swift=
// BankManager.swift

...

let bankingElapsedTime = 0.0

while !bankQueue.isEmpty {
    ...
    
    bankingElapsedTime += 0.7
    
    ...
}

...
```

##### ğŸ› ï¸ í•´ê²° ë°©ë²•
- `DispatchTime.now()` ë©”ì„œë“œë¥¼ í™œìš©í•˜ì—¬ ì—…ë¬´ì‹œê°„ êµ¬í•˜ëŠ” ë¡œì§ì„ êµ¬í˜„í•˜ì˜€ìŠµë‹ˆë‹¤. ë‹¨ìœ„ê°€ ë‚˜ë…¸ ì´ˆì´ê¸° ë•Œë¬¸ì— `1_000_000_000`ìœ¼ë¡œ ë‚˜ëˆ ì¤¬ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  ì†Œìˆ˜ì  ë‘˜ì§¸ ìë¦¬ê¹Œì§€ í‘œí˜„í•˜ê¸° ìœ„í•´ extensionë¥¼ ì´ìš©í•˜ì—¬ Doubleì— `rounded(toPlaces: Int)` ë©”ì„œë“œë¥¼ í™•ì¥í–ˆìŠµë‹ˆë‹¤. ê²°ë¡ ì ìœ¼ë¡œ, ì›í•˜ëŠ” ì‹œê°„ ë‹¨ìœ„ ë° ìë¦¬ ìˆ˜ë¡œ ì¶œë ¥í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```swift=
// BankManager.swift

...

let bankingStartTime = DispatchTime.now()

while !bankQueue.isEmpty {
    ...
}

let bankingEndTime = DispatchTime.now()
let bankingElapsedTime = (Double(bankingEndTime - bankingStartTime) / 1_000_000_000)
print("ì—…ë¬´ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•œ ê³ ê°ì€ ì´ \(visitedCustomerNumber)ëª…ì´ë©°, ì´ ì—…ë¬´ì‹œê°„ì€ \(bankingElapsedTime.rounded(toPlaces: 2))ì´ˆì…ë‹ˆë‹¤.")

...

```
```swift=
// Double+rounded.swift

extension Double {
    func rounded(toPlaces: Int) -> Double {
        let divisor = pow(10.0, Double(toPlaces))
        return (self * divisor).rounded() / divisor
    }
}
```

#### 2. â—ï¸ì€í–‰ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ í•  ê²½ìš° ë°œìƒí•˜ëŠ” ë¬¸ì œì 
##### ğŸ“Œ ë¬¸ì œ ìƒí™©
- ì´ ëª¨ë“ˆì€ UI ì•±ì—ì„œë„ ì‚¬ìš©ë˜ì–´ì•¼ í•˜ë‚˜, ë‹¨ìˆœ ë°˜ë³µë¬¸ë§Œì„ ì‚¬ìš©í•´ ë©”ì¸ ìŠ¤ë ˆë“œì—ì„œ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•  ê²½ìš° ì²˜ë¦¬í•˜ëŠ” ë™ì•ˆ `Thread.sleep(forTimeInterval:)`ë¡œ í˜„ì¬ ìŠ¤ë ˆë“œ(ë©”ì¸ ìŠ¤ë ˆë“œ)ë¥¼ ë©ˆì¶”ê¸° ë•Œë¬¸ì— UI ì²˜ë¦¬ê°€ ë¶ˆê°€ëŠ¥í•˜ê²Œë˜ê³  ì¾Œì í•˜ì§€ ëª»í•œ ì‚¬ìš©ì ê²½í—˜ì„ ìœ ë°œí•  ìˆ˜ ìˆë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

```swift=
// BankManager.swift

...

while !bankQueue.isEmpty {
    guard let customer = bankQueue.dequeue else { break }
    
    ...
    
    Thread.sleep(forTimeInterval: 0.7)
    
    ...
}

...

```

##### ğŸ› ï¸ í•´ê²° ë°©ë²•
- `DispatchQueue.global()`ì„ í™œìš©í•´ ì—…ë¬´ ì²˜ë¦¬ê°€ ë©”ì¸ ìŠ¤ë ˆë“œê°€ ì•„ë‹Œ ë‹¤ë¥¸ ìŠ¤ë ˆë“œì—ì„œ ì²˜ë¦¬ë  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤. ë˜í•œ ì€í–‰ì›ì˜ ìˆ˜ì˜ ë³€í™”ì— ìœ ì—°í•˜ê²Œ ëŒ€ì‘í•  ìˆ˜ ìˆë„ë¡ DispatchSemaphoreë¥¼ ì‚¬ìš©í•´ ë™ì‹œì— ì‹¤í–‰ë  ìˆ˜ ìˆëŠ” Taskì˜ ìˆ˜ë¥¼ ì •í•´ì¤„ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.
```swift=
// BankManager.swift

...

let concurrentLimitingSemaphore = DispatchSemaphore(value: numberOfBankClerk)

while !bankQueue.isEmpty {
    concurrentLimitingSemaphore.wait()

    guard let customer = bankQueue.dequeue() else { return }

    DispatchQueue.global().async {
        ...
        Thread.sleep(forTimeInterval: 0.7)
        ...
        concurrentLimitingSemaphore.signal()
    }
}

...

```

#### 3. â—ï¸ë§ˆì§€ë§‰ ê³ ê°ì˜ ì—…ë¬´ë¥¼ ì‹œì‘í•˜ê³  ë°”ë¡œ ì—…ë¬´ë¥¼ ë§ˆê°í•˜ëŠ” ë¬¸ì œ
##### ğŸ“Œ ë¬¸ì œ ìƒí™©
- `DispatchQueue.global().async`ì˜ blockì„ globalíì— ë„£ê³  ë°”ë¡œ ë‹¤ìŒ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê¸° ë•Œë¬¸ì— ë§ˆì§€ë§‰ ê³ ê°ì˜ ì—…ë¬´ë¥¼ ì‹œì‘ì€ í•˜ë‚˜, ì™„ë£Œí•˜ì§€ ì•Šê³  ì€í–‰ ì—…ë¬´ ìì²´ë¥¼ ë§ˆê°í•´ë²„ë¦¬ëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.
```swift=
/// BankManager.swift

...

let concurrentLimitingSemaphore = DispatchSemaphore(value: numberOfBankClerk)

while !bankQueue.isEmpty {
    concurrentLimitingSemaphore.wait()

    guard let customer = bankQueue.dequeue() else { return }

    DispatchQueue.global().async {
        ...
        Thread.sleep(forTimeInterval: 0.7)
        ...
        concurrentLimitingSemaphore.signal()
    }
}

...

```

##### ğŸ› ï¸ í•´ê²° ë°©ë²•
- `DispatchQueue.global().async`ì˜ blockì„ `bankingGroup`ìœ¼ë¡œ ë¬¶ì–´ ëª¨ë“  ê³ ê°ì˜ ì—…ë¬´ê°€ ì²˜ë¦¬ë  ë•Œê¹Œì§€ ëŒ€ê¸°í•´ì£¼ë„ë¡ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.
```swift=
// BankManager.swift

...

let concurrentLimitingSemaphore = DispatchSemaphore(value: numberOfBankClerk)
let bankingGroup = DispatchGroup()

while !bankQueue.isEmpty {
    concurrentLimitingSemaphore.wait()

    guard let customer = bankQueue.dequeue() else { return }

    DispatchQueue.global().async(group: bankingGroup) {
        ...
        Thread.sleep(forTimeInterval: 0.7)
        ...
        concurrentLimitingSemaphore.signal()
    }
}

bankingGroup.wait()

...

```

#### 4. â—ï¸`BankManger` ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ì•±ì—ì„œ í™œìš©í•  ë•Œ ìœ ì—°í•œ í–‰ë™ì„ í•  ìˆ˜ ì—†ëŠ” ë¬¸ì œ
##### ğŸ“Œ ë¬¸ì œ ìƒí™©
- `BankManager` ëª¨ë“ˆì€ ì€í–‰ ì—…ë¬´ ì‹œì‘, ì¢…ë£Œ í–‰ë™ì„ print()ë¬¸ìœ¼ë¡œ ì‹¤í–‰í•˜ì—¬ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ, í•´ë‹¹ ëª¨ë“ˆì„ ì‚¬ìš©í•˜ëŠ” ëª¨ë“  ì•±ì€ ê°•ì œì ìœ¼ë¡œ ì€í–‰ ì—…ë¬´ì— ëŒ€í•œ ë¡œê·¸ë¥¼ ì‹¤í–‰í•´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ìˆì—ˆê¸° ë•Œë¬¸ì— íŠ¸ëŸ¬ë¸” ìŠˆíŒ…ì´ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤.

```swift=
// BankManager.swift

public final class BankManager {
    ...
    
    public func commenceBanking() {
        ...
        
        DispatchQueue.global().async(group: bankingGroup) {
            ...
            
            print("\(customer.waitingNumber)ë²ˆ ê³ ê° ì—…ë¬´ ì‹œì‘")
            Thread.sleep(forTimeInterval: 0.7)
            print("\(customer.waitingNumber)ë²ˆ ê³ ê° ì—…ë¬´ ì™„ë£Œ")
            
            ...
        }
        
        ...
        
        print("ì—…ë¬´ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•œ ê³ ê°ì€ ì´ \(visitedCustomerNumber)ëª…ì´ë©°, ì´ ì—…ë¬´ì‹œê°„ì€ \(bankingElapsedTime.rounded(toPlaces: 2))ì´ˆì…ë‹ˆë‹¤.")
    }
}

```

##### ğŸ› ï¸ í•´ê²° ë°©ë²•
- `BankManagerDelegate` í”„ë¡œí† ì½œ ìƒì„±, `Delegate` íŒ¨í„´ì„ í™œìš©í•˜ì˜€ìŠµë‹ˆë‹¤. ê·¸ë¦¬í•˜ì—¬ `BankManager` ëª¨ë“ˆì˜ ì€í–‰ ì—…ë¬´ ì‹œì‘, ì¢…ë£Œ í–‰ë™ì„ ìœ ì—°í•˜ê²Œ ë§Œë“¤ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

```swift=
// BankManager.swift

public protocol BankManagerDelegate: AnyObject {
    func bankingStarted(customer: Customer)
    func bankingEnded(customer: Customer)
    func bankClosed(customersCount: Int, elapsedTime: Double)
}

public final class BankManager {
    public weak var delegate: BankManagerDelegate?
    
    ...
    
    public func commenceBanking() {
        ...
        
        DispatchQueue.global().async(group: bankingGroup) {
            ...
            
            self.delegate?.bankingStarted(customer: customer)
            Thread.sleep(forTimeInterval: customer.banking.requiredTime)
            self.delegate?.bankingEnded(customer: customer)
            
            ...
        }
        
        ...
        
        self.delegate?.bankClosed(customersCount: customersCount, elapsedTime: bankingElapsedTime)
    }
}
```

```swift=
//ConsoleApp.swift

final class ConsoleApp: BankManagerDelegate {
    var bankManager: BankManager
    
    init() {
        bankManager = BankManager(loanClerksCount: 1, depositClerksCount: 2)
        bankManager.delegate = self
    }
    
    ...
    
    func bankingStarted(customer: Customer) {
        print("\(customer.waitingNumber)ë²ˆ ê³ ê° \(customer.banking.name)ì—…ë¬´ ì‹œì‘")
    }
    
    func bankingEnded(customer: Customer) {
        print("\(customer.waitingNumber)ë²ˆ ê³ ê° \(customer.banking.name)ì—…ë¬´ ì¢…ë£Œ")
    }
    
    func bankClosed(customersCount: Int, elapsedTime: Double) {
        print("ì—…ë¬´ê°€ ë§ˆê°ë˜ì—ˆìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ì—…ë¬´ë¥¼ ì²˜ë¦¬í•œ ê³ ê°ì€ ì´ \(customersCount)ëª…ì´ë©°, ì´ ì—…ë¬´ì‹œê°„ì€ \(elapsedTime.rounded(toPlaces: 2))ì´ˆì…ë‹ˆë‹¤.")
    }
}

```

### 7. íŒ€ íšŒê³ 
#### ìš°ë¦¬íŒ€ì´ ì˜í•œ ì  ğŸ˜
- Danny
  - ì½”ë”© ì»¨ë²¤ì…˜ì„ ì˜ ì§€ì¼°ìŠµë‹ˆë‹¤. ìƒí˜¸ ì˜ê²¬ì„ ì¡´ì¤‘í–ˆìŠµë‹ˆë‹¤.
  - Delegate íŒ¨í„´ì— ëŒ€í•´ ì ê·¹ì ìœ¼ë¡œ ê³µë¶€í•˜ê³  ëª¨ë¥´ëŠ” ê²ƒì„ ë¬¼ì–´ë³´ê³ ì ë…¸ë ¥í–ˆìŠµë‹ˆë‹¤.
  - ì„œë¡œ ì¼ì •ì´ ì–´ë µë‹¤ë©´ ë¯¸ë¦¬ ì¡°ì›ì—ê²Œ ì•Œë ¤ì„œ ì¼ì • ì¡°ì •ì„ í•˜ì˜€ìŠµë‹ˆë‹¤.
- Prism 
  - í•˜ë‚˜ì˜ ëª¨ë“ˆì„ ì—¬ëŸ¬ ì•±(Console, UI)ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆë„ë¡ ì—­í• ì— ë§ê²Œ ëª¨ë“ˆí™”í–ˆìŠµë‹ˆë‹¤
  - ì€í–‰ì›ì˜ ì—…ë¬´ ì²˜ë¦¬ë¥¼ ë™ì‹œì„± í”„ë¡œê·¸ë˜ë°ì„ í™œìš©í•´ ì„±ê³µì ìœ¼ë¡œ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤
  - í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ì ê·¹ì ìœ¼ë¡œ ì†Œí†µí•´ íŠ¸ëŸ¬ë¸” ì—†ì´ í”„ë¡œì íŠ¸ë¥¼ ë§ˆë¬´ë¦¬í–ˆìŠµë‹ˆë‹¤

### 8. ì°¸ê³  ìë£Œ
ğŸ“[Generics](<https://docs.swift.org/swift-book/documentation/the-swift-programming-language/generics>)  
ğŸ“[Testing your apps in Xcode](<https://developer.apple.com/documentation/xcode/testing-your-apps-in-xcode>)  
ğŸ“[Dispatch Queues](<https://developer.apple.com/library/archive/documentation/General/Conceptual/ConcurrencyProgrammingGuide/OperationQueues/OperationQueues.html>)  
ğŸ“[Rounding a double value to x number of decimal places in swift](<https://stackoverflow.com/questions/27338573/rounding-a-double-value-to-x-number-of-decimal-places-in-swift>)  
